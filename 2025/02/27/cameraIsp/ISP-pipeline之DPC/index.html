<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>ISP pipeline之DPC | Stephen`s Blog</title>
  <meta name="description" content="DPC概述由于sensor制造工艺技术瑕疵或光线采集存在缺陷，获得的原始图像数据就存在一些坏点，一般是某个邻域内的极亮或极暗点。 DPC矫正原理一般以一个5x5的邻域作为检测区域，并且常用梯度法进行检测。  如上图所示，Pc作为被检测点，步骤如下：1、先算出4个方向的二阶梯度：    水平方向：Dh1 &#x3D; |P1+P3-2P2|, Dh2 &#x3D; |P4+P5-2Pc|,Dh3 &amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="ISP pipeline之DPC">
<meta property="og:url" content="http://example.com/2025/02/27/cameraIsp/ISP-pipeline%E4%B9%8BDPC/index.html">
<meta property="og:site_name" content="StephenLu&#96;s Blog">
<meta property="og:description" content="DPC概述由于sensor制造工艺技术瑕疵或光线采集存在缺陷，获得的原始图像数据就存在一些坏点，一般是某个邻域内的极亮或极暗点。 DPC矫正原理一般以一个5x5的邻域作为检测区域，并且常用梯度法进行检测。  如上图所示，Pc作为被检测点，步骤如下：1、先算出4个方向的二阶梯度：    水平方向：Dh1 &#x3D; |P1+P3-2P2|, Dh2 &#x3D; |P4+P5-2Pc|,Dh3 &amp;">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-02-27T02:56:05.000Z">
<meta property="article:modified_time" content="2025-03-07T05:57:11.503Z">
<meta property="article:author" content="Stephen Lu">
<meta property="article:tag" content="ISP">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://example.com/2025/02/27/cameraIsp/ISP-pipeline%E4%B9%8BDPC/index.html">
  
    <link rel="alternate" href="/atom.xml" title="StephenLu`s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 6.3.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/Stephen-Lu-Fahai" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">StephenLu</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Embedded Software Developer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
      </ul>
      
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>Stephen`s Blog!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ISP/">ISP</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux%E9%A9%B1%E5%8A%A8/">Linux驱动</a><span class="category-list-count">30</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenGL/">OpenGL</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Qt/">Qt</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Qt4Android/">Qt4Android</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/STM32/">STM32</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/armLinux/">armLinux</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cuda/">cuda</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/dicom/">dicom</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gstreamer/">gstreamer</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/openCL/">openCL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ubuntu%E7%B3%BB%E7%BB%9F/">ubuntu系统</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BC%BA%E6%9C%8D%E6%8E%A7%E5%88%B6/">伺服控制</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1/">模式设计</a><span class="category-list-count">23</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ISP/" rel="tag">ISP</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux%E9%A9%B1%E5%8A%A8-%E5%AE%9E%E8%B7%B5/" rel="tag">Linux驱动[实践]</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux%E9%A9%B1%E5%8A%A8-%E7%90%86%E8%AE%BA/" rel="tag">Linux驱动[理论]</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenGL/" rel="tag">OpenGL</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/" rel="tag">Qt</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt4Android/" rel="tag">Qt4Android</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STM32/" rel="tag">STM32</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/armLinux/" rel="tag">armLinux</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cuda/" rel="tag">cuda</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dicom/" rel="tag">dicom</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gstreamer/" rel="tag">gstreamer</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openCL/" rel="tag">openCL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu%E7%B3%BB%E7%BB%9F/" rel="tag">ubuntu系统</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%BA%E6%9C%8D%E6%8E%A7%E5%88%B6/" rel="tag">伺服控制</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1/" rel="tag">模式设计</a><span class="tag-list-count">23</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/C/" style="font-size: 13.44px;">C++</a> <a href="/tags/ISP/" style="font-size: 13.22px;">ISP</a> <a href="/tags/Linux%E9%A9%B1%E5%8A%A8-%E5%AE%9E%E8%B7%B5/" style="font-size: 13.78px;">Linux驱动[实践]</a> <a href="/tags/Linux%E9%A9%B1%E5%8A%A8-%E7%90%86%E8%AE%BA/" style="font-size: 13.78px;">Linux驱动[理论]</a> <a href="/tags/OpenGL/" style="font-size: 13.67px;">OpenGL</a> <a href="/tags/Qt/" style="font-size: 13.56px;">Qt</a> <a href="/tags/Qt4Android/" style="font-size: 13.11px;">Qt4Android</a> <a href="/tags/STM32/" style="font-size: 13px;">STM32</a> <a href="/tags/armLinux/" style="font-size: 13.67px;">armLinux</a> <a href="/tags/cuda/" style="font-size: 13.11px;">cuda</a> <a href="/tags/dicom/" style="font-size: 13.33px;">dicom</a> <a href="/tags/gstreamer/" style="font-size: 13.33px;">gstreamer</a> <a href="/tags/openCL/" style="font-size: 13px;">openCL</a> <a href="/tags/ubuntu%E7%B3%BB%E7%BB%9F/" style="font-size: 13.89px;">ubuntu系统</a> <a href="/tags/windows/" style="font-size: 13.11px;">windows</a> <a href="/tags/%E4%BC%BA%E6%9C%8D%E6%8E%A7%E5%88%B6/" style="font-size: 13.33px;">伺服控制</a> <a href="/tags/%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1/" style="font-size: 14px;">模式设计</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/12/">十二月 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">十一月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">十月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">九月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">八月 2025</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/07/">七月 2025</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">六月 2025</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">五月 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">四月 2025</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">三月 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">二月 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">十二月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">十月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">九月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">八月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">十月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">九月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/windows/">windows</a>
              </p>
              <p class="item-title">
                <a href="/2025/12/25/windows/windows10-minGW%E7%BC%96%E8%AF%91vtk/" class="title">windows10 minGW编译vtk</a>
              </p>
              <p class="item-date">
                <time datetime="2025-12-25T08:26:54.000Z" itemprop="datePublished">2025-12-25</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/windows/">windows</a>
              </p>
              <p class="item-title">
                <a href="/2025/12/12/windows/windows10-%E8%BD%AC%E5%8C%96%E5%8F%8A%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC%E5%B9%B6%E5%AE%89%E8%A3%85WSL%E5%AD%90%E7%B3%BB%E7%BB%9F/" class="title">windows10 转化及升级版本并安装WSL子系统</a>
              </p>
              <p class="item-date">
                <time datetime="2025-12-12T05:15:00.000Z" itemprop="datePublished">2025-12-12</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/OpenGL/">OpenGL</a>
              </p>
              <p class="item-title">
                <a href="/2025/12/03/OpenGl/win10%E7%BC%96%E8%AF%91minGW%E7%89%88%E6%9C%AC%E7%9A%84assimp/" class="title">win10编译minGW版本的assimp</a>
              </p>
              <p class="item-date">
                <time datetime="2025-12-03T08:06:13.000Z" itemprop="datePublished">2025-12-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Qt/">Qt</a>
              </p>
              <p class="item-title">
                <a href="/2025/11/25/Qt/Qt%E5%A4%84%E7%90%86xml%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E7%9A%84%E9%97%AE%E9%A2%98/" class="title">Qt处理xml中文乱码的问题</a>
              </p>
              <p class="item-date">
                <time datetime="2025-11-25T09:14:15.000Z" itemprop="datePublished">2025-11-25</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/ubuntu%E7%B3%BB%E7%BB%9F/">ubuntu系统</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/13/ubuntu/ssh%E8%BD%AC%E5%8F%91%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/" class="title">ssh转发使用总结</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-13T08:59:33.000Z" itemprop="datePublished">2025-10-13</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-cameraIsp/ISP-pipeline之DPC" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      ISP pipeline之DPC
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2025/02/27/cameraIsp/ISP-pipeline%E4%B9%8BDPC/" class="article-date">
	  <time datetime="2025-02-27T02:56:05.000Z" itemprop="datePublished">2025-02-27</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/ISP/">ISP</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/ISP/" rel="tag">ISP</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2025/02/27/cameraIsp/ISP-pipeline%E4%B9%8BDPC/#comments" class="article-comment-link">Comments</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 4.4k(words)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Count: 26(minutes)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="DPC概述"><a href="#DPC概述" class="headerlink" title="DPC概述"></a>DPC概述</h1><p>由于sensor制造工艺技术瑕疵或光线采集存在缺陷，获得的原始图像数据就存在一些坏点，一般是某个邻域内的极亮或极暗点。</p>
<h1 id="DPC矫正原理"><a href="#DPC矫正原理" class="headerlink" title="DPC矫正原理"></a>DPC矫正原理</h1><p>一般以一个5x5的邻域作为检测区域，并且常用梯度法进行检测。</p>
<p><img src="data:image/jpeg;base64,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"></p>
<p>如上图所示，Pc作为被检测点，步骤如下：<br>1、先算出4个方向的二阶梯度：<br>    水平方向：Dh1 &#x3D; |P1+P3-2<em>P2|, Dh2 &#x3D; |P4+P5-2</em>Pc|,Dh3 &#x3D; |P6+P8-2<em>P7|;<br>    竖直方向：Dv1 &#x3D; |P1+P6-2</em>P4|, Dv2 &#x3D; |P2+P7-2<em>Pc|,Dv3 &#x3D; |P3+P8-2</em>P5|;<br>    45°方向： D45_1 &#x3D; 2*|P4-P2|, D45_2 &#x3D;|P3+P6-2<em>Pc|, D45_3 &#x3D; 2</em>|P7-P5|;<br>    135°方向：D135_1 &#x3D; 2*|P2-P5|, D135_2 &#x3D;|P1+P8-2<em>Pc|, D135_3 &#x3D; 2</em>|P7-P4|;</p>
<p>2、求取各方向梯度绝对值的中值。</p>
<p>3、选取四个方向中值的最小值作为边缘方向。</p>
<p>4、如果最小梯度方向为水平或者竖直，若过Pc那个梯度的绝对值大于同方向的另外两个梯度绝对值和的4倍，则Pc为坏点；</p>
<p>5、如果是45°方向，则计算135°三个梯度绝对值两两之差的绝对值的和，<br>    D135_sum &#x3D; |D135_1 - D135_2| + |D135_1 - D135_3| + |D135_2 - D135_3|;<br>    如果D135_sum小于100，若此时D45_2 &gt; 3x(D45_1+D45_3) 且 D135_2&gt;3x(D135_1+D135_3)，则Pc为坏点。否则D45_2&gt;3x(D45_1+D45_3)就为坏点；</p>
<p>6、135°方向和45°相反的方向计算和判断即可；</p>
<p>7、为减少漏判，当Pc小于15且周围点都大于Pc40以上，则Pc为坏点。如果Pc大于230，且周围的点都下于Pc30以下，则该点为坏点；</p>
<p>8、边缘为水平方向，且判断为坏点，如过|P4-Pc|&lt;|Pc-P5|则Pc更靠近P4，根据同一颜色通道亮度的渐变性可以推导出ouput&#x3D;P4+(P2+P7-P1-P6)&#x2F;2; 否则ouput&#x3D;P5+(P2+P7-P3-P8)&#x2F;2；</p>
<p>9、如果为竖直方向可以参考水平方向求出。</p>
<p>10、边缘为45°，如果|P3-Pc|&lt;|P6-Pc|则根据同一原则output&#x3D;P3+(P4+P7-P2-p5)&#x2F;2;否则为output&#x3D;P7+(P2+P5-P7-p3)&#x2F;2；</p>
<p>11、边缘为135°则按照45°的方式反过来计算即可。</p>
<h1 id="cuda代码"><a href="#cuda代码" class="headerlink" title="cuda代码"></a>cuda代码</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br></pre></td><td class="code"><pre><span class="line">__global__ <span class="type">void</span> <span class="title function_">cuDeadPixelCorrectionBGGR</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> *pSrc, <span class="type">unsigned</span> <span class="type">short</span> *pDst, <span class="type">int</span> iWidth, <span class="type">int</span> iHeight, <span class="type">int</span> iSrcStride, <span class="type">int</span> iDstStride, <span class="type">unsigned</span> <span class="type">short</span> iThreshold)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> dx = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="type">int</span> dy = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    <span class="comment">//if (dx &gt;= iWidth || dy &gt;= iHeight)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    return;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> lx = threadIdx.x;</span><br><span class="line">    <span class="type">int</span> ly = threadIdx.y;</span><br><span class="line">    <span class="type">int</span> bx = threadIdx.y * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="comment">// twice of half filter length plus local size</span></span><br><span class="line">    <span class="type">int</span> iBlockLen = <span class="number">4</span> + DEMOSAIC_LOCAL_SIZE;</span><br><span class="line">    <span class="comment">// the offset at the start of the row</span></span><br><span class="line">    <span class="type">int</span> iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">    <span class="comment">// index to the current pixel</span></span><br><span class="line">    <span class="type">int</span> iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dx &lt; iWidth and dy &lt; iHeight)</span><br><span class="line">    &#123;</span><br><span class="line">        cached[iLocalIdx] = pSrc[dy * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// copy additional data for boarder</span></span><br><span class="line">        <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[iLocalRowStartIdx + lx] = pSrc[dy * iSrcStride + iSrcX];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[iLocalIdx + <span class="number">2</span>] = pSrc[dy * iSrcStride + iSrcX];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ly &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[ly * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[ly * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[ly * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ly &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// the bottom of local box may not aligned with the bottom of the image</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// sync</span></span><br><span class="line">    __syncthreads();</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> pixelNeig[<span class="number">8</span>];</span><br><span class="line">    <span class="comment">//&lt;@Aaron, G channel:</span></span><br><span class="line">    <span class="keyword">if</span> (bx &lt; <span class="number">64</span>)<span class="comment">//&lt;G,  this is a Green in the B row</span></span><br><span class="line">    &#123;</span><br><span class="line">        lx = (threadIdx.x/<span class="number">2</span>)*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        ly = threadIdx.y*<span class="number">2</span> + (threadIdx.x%<span class="number">2</span>)*<span class="number">8</span>;</span><br><span class="line">        dx = blockIdx.x * blockDim.x + lx;</span><br><span class="line">        dy = blockIdx.y * blockDim.y + ly;</span><br><span class="line">        <span class="comment">// the offset at the start of the row</span></span><br><span class="line">        iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">        <span class="comment">// index to the current pixel</span></span><br><span class="line">        iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// this is a Green in the B row</span></span><br><span class="line">        pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">        pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">        pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">        pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">        pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bx &lt; <span class="number">128</span>)<span class="comment">//&lt;G, this is a Green in the R row</span></span><br><span class="line">    &#123;</span><br><span class="line">        lx = (threadIdx.x/<span class="number">2</span>)*<span class="number">2</span>;</span><br><span class="line">        ly = (threadIdx.y<span class="number">-4</span>)*<span class="number">2</span> + (threadIdx.x%<span class="number">2</span>)*<span class="number">8</span> + <span class="number">1</span>;</span><br><span class="line">        dx = blockIdx.x * blockDim.x + lx;</span><br><span class="line">        dy = blockIdx.y * blockDim.y + ly;</span><br><span class="line">        <span class="comment">// the offset at the start of the row</span></span><br><span class="line">        iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">        <span class="comment">// index to the current pixel</span></span><br><span class="line">        iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">        pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">        pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">        pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">        pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bx &lt; <span class="number">192</span>)<span class="comment">//&lt;B,</span></span><br><span class="line">    &#123;</span><br><span class="line">        lx = (threadIdx.x/<span class="number">2</span>)*<span class="number">2</span>;</span><br><span class="line">        ly = (threadIdx.y<span class="number">-8</span>)*<span class="number">2</span> + (threadIdx.x%<span class="number">2</span>)*<span class="number">8</span>;</span><br><span class="line">        dx = blockIdx.x * blockDim.x + lx;</span><br><span class="line">        dy = blockIdx.y * blockDim.y + ly;</span><br><span class="line">        <span class="comment">// the offset at the start of the row</span></span><br><span class="line">        iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">        <span class="comment">// index to the current pixel</span></span><br><span class="line">        iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span><span class="comment">//&lt;R,</span></span><br><span class="line">    &#123;</span><br><span class="line">        lx = (threadIdx.x/<span class="number">2</span>)*<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        ly = (threadIdx.y<span class="number">-12</span>)*<span class="number">2</span> + (threadIdx.x%<span class="number">2</span>)*<span class="number">8</span> + <span class="number">1</span>;</span><br><span class="line">        dx = blockIdx.x * blockDim.x + lx;</span><br><span class="line">        dy = blockIdx.y * blockDim.y + ly;</span><br><span class="line">        <span class="comment">// the offset at the start of the row</span></span><br><span class="line">        iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">        <span class="comment">// index to the current pixel</span></span><br><span class="line">        iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> centerPixel = cached[iLocalIdx];</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> medianV;</span><br><span class="line">    <span class="type">int</span> nConditionValue = <span class="number">0</span>;</span><br><span class="line">    <span class="type">short</span> pixelNeigDiff = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        pixelNeigDiff = (<span class="type">short</span>)pixelNeig[i] - (<span class="type">short</span>)centerPixel;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            nConditionValue += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            nConditionValue -= <span class="number">1</span>;</span><br><span class="line">            pixelNeigDiff = -pixelNeigDiff;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt;= iThreshold)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">abs</span>(nConditionValue) &lt;= i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> iDstIdx = dy * iDstStride + dx;</span><br><span class="line">    <span class="keyword">if</span> (iDstIdx &gt;= iDstStride*iHeight)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(nConditionValue) &lt; <span class="number">8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        pDst[iDstIdx] = centerPixel;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        cuClassicMedianFilter(pixelNeig, <span class="number">8</span>, &amp;medianV);</span><br><span class="line">        pDst[iDstIdx] = medianV;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">DeadPixelCorrectionBGGR</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span>* pSrc, <span class="type">unsigned</span> <span class="type">short</span>* pDst, <span class="type">int</span> iWidth, <span class="type">int</span> iHeight, <span class="type">int</span> iSrcStride, <span class="type">int</span> iDstStride, <span class="type">unsigned</span> <span class="type">short</span> iThreshold)</span></span><br><span class="line">&#123;</span><br><span class="line">    dim3 <span class="title function_">numThreads</span><span class="params">(<span class="number">16</span>, <span class="number">16</span>, <span class="number">1</span>)</span>; <span class="comment">// do not change, has to be 16</span></span><br><span class="line">    dim3 <span class="title function_">numBlocks</span><span class="params">(DivUp(iWidth, numThreads.x), DivUp(iHeight, numThreads.y))</span>;</span><br><span class="line"></span><br><span class="line">    cuDeadPixelCorrectionBGGR&lt;&lt;&lt;numBlocks, numThreads, <span class="number">20</span> * <span class="number">20</span> * <span class="keyword">sizeof</span>(<span class="type">unsigned</span> <span class="type">short</span>)&gt;&gt;&gt;(pSrc, pDst, iWidth, iHeight, iSrcStride, iDstStride, iThreshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">cuDeadPixelCorrectionRGGB</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> *pSrc, <span class="type">unsigned</span> <span class="type">short</span> *pDst, <span class="type">int</span> iWidth, <span class="type">int</span> iHeight, <span class="type">int</span> iSrcStride, <span class="type">int</span> iDstStride, <span class="type">unsigned</span> <span class="type">short</span> iThreshold)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> dx = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="type">int</span> dy = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    <span class="comment">//if (dx &gt;= iWidth || dy &gt;= iHeight)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    return;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> lx = threadIdx.x;</span><br><span class="line">    <span class="type">int</span> ly = threadIdx.y;</span><br><span class="line">    <span class="type">int</span> bx = threadIdx.y * blockDim.x + threadIdx.x;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// twice of half filter length plus local size</span></span><br><span class="line">    <span class="type">int</span> iBlockLen = <span class="number">4</span> + DEMOSAIC_LOCAL_SIZE;</span><br><span class="line">    <span class="comment">// the offset at the start of the row</span></span><br><span class="line">    <span class="type">int</span> iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">    <span class="comment">// index to the current pixel</span></span><br><span class="line">    <span class="type">int</span> iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (dx &lt; iWidth and dy &lt; iHeight)</span><br><span class="line">    &#123;</span><br><span class="line">        cached[iLocalIdx] = pSrc[dy * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// copy additional data for border</span></span><br><span class="line">        <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[iLocalRowStartIdx + lx] = pSrc[dy * iSrcStride + iSrcX];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[iLocalIdx + <span class="number">2</span>] = pSrc[dy * iSrcStride + iSrcX];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ly &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[ly * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[ly * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[ly * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ly &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// the bottom of local box may not aligned with the bottom of the image</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">                &#123;</span><br><span class="line">                    EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// sync</span></span><br><span class="line">    __syncthreads();</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> pixelNeig[<span class="number">8</span>];</span><br><span class="line">    <span class="comment">//&lt;@Aaron, G channel:</span></span><br><span class="line">    <span class="keyword">if</span> (bx &lt; <span class="number">64</span>)<span class="comment">//&lt;G,  this is a Green in the B row</span></span><br><span class="line">    &#123;</span><br><span class="line">        lx = (threadIdx.x/<span class="number">2</span>)*<span class="number">2</span>;</span><br><span class="line">        ly = threadIdx.y*<span class="number">2</span> + (threadIdx.x%<span class="number">2</span>)*<span class="number">8</span> + <span class="number">1</span>;</span><br><span class="line">        dx = blockIdx.x * blockDim.x + lx;</span><br><span class="line">        dy = blockIdx.y * blockDim.y + ly;</span><br><span class="line">        <span class="comment">// the offset at the start of the row</span></span><br><span class="line">        iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">        <span class="comment">// index to the current pixel</span></span><br><span class="line">        iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// this is a Green in the B row</span></span><br><span class="line">        pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">        pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">        pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">        pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">        pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bx &lt; <span class="number">128</span>)<span class="comment">//&lt;G, this is a Green in the R row</span></span><br><span class="line">    &#123;</span><br><span class="line">        lx = (threadIdx.x/<span class="number">2</span>)*<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        ly = (threadIdx.y<span class="number">-4</span>)*<span class="number">2</span> + (threadIdx.x%<span class="number">2</span>)*<span class="number">8</span>;</span><br><span class="line">        dx = blockIdx.x * blockDim.x + lx;</span><br><span class="line">        dy = blockIdx.y * blockDim.y + ly;</span><br><span class="line">        <span class="comment">// the offset at the start of the row</span></span><br><span class="line">        iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">        <span class="comment">// index to the current pixel</span></span><br><span class="line">        iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">        pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">        pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">        pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">        pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (bx &lt; <span class="number">192</span>)<span class="comment">//&lt;B,</span></span><br><span class="line">    &#123;</span><br><span class="line">        lx = (threadIdx.x/<span class="number">2</span>)*<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        ly = (threadIdx.y<span class="number">-8</span>)*<span class="number">2</span> + (threadIdx.x%<span class="number">2</span>)*<span class="number">8</span> + <span class="number">1</span>;</span><br><span class="line">        dx = blockIdx.x * blockDim.x + lx;</span><br><span class="line">        dy = blockIdx.y * blockDim.y + ly;</span><br><span class="line">        <span class="comment">// the offset at the start of the row</span></span><br><span class="line">        iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">        <span class="comment">// index to the current pixel</span></span><br><span class="line">        iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span><span class="comment">//&lt;R,</span></span><br><span class="line">    &#123;</span><br><span class="line">        lx = (threadIdx.x/<span class="number">2</span>)*<span class="number">2</span>;</span><br><span class="line">        ly = (threadIdx.y<span class="number">-12</span>)*<span class="number">2</span> + (threadIdx.x%<span class="number">2</span>)*<span class="number">8</span>;</span><br><span class="line">        dx = blockIdx.x * blockDim.x + lx;</span><br><span class="line">        dy = blockIdx.y * blockDim.y + ly;</span><br><span class="line">        <span class="comment">// the offset at the start of the row</span></span><br><span class="line">        iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">        <span class="comment">// index to the current pixel</span></span><br><span class="line">        iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">        pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> centerPixel = cached[iLocalIdx];</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> medianV;</span><br><span class="line">    <span class="type">int</span> nConditionValue = <span class="number">0</span>;</span><br><span class="line">    <span class="type">short</span> pixelNeigDiff = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        pixelNeigDiff = (<span class="type">short</span>)pixelNeig[i] - (<span class="type">short</span>)centerPixel;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            nConditionValue += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            nConditionValue -= <span class="number">1</span>;</span><br><span class="line">            pixelNeigDiff = -pixelNeigDiff;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt;= iThreshold)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">abs</span>(nConditionValue) &lt;= i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> iDstIdx = dy * iDstStride + dx;</span><br><span class="line">    <span class="keyword">if</span> (iDstIdx &gt;= iDstStride*iHeight)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(nConditionValue) &lt; <span class="number">8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        pDst[iDstIdx] = centerPixel;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        cuClassicMedianFilter(pixelNeig, <span class="number">8</span>, &amp;medianV);</span><br><span class="line">        pDst[iDstIdx] = medianV;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">DeadPixelCorrectionRGGB</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span>* pSrc, <span class="type">unsigned</span> <span class="type">short</span>* pDst, <span class="type">int</span> iWidth, <span class="type">int</span> iHeight, <span class="type">int</span> iSrcStride, <span class="type">int</span> iDstStride, <span class="type">unsigned</span> <span class="type">short</span> iThreshold)</span></span><br><span class="line">&#123;</span><br><span class="line">    dim3 <span class="title function_">numThreads</span><span class="params">(<span class="number">16</span>, <span class="number">16</span>, <span class="number">1</span>)</span>; <span class="comment">// do not change, has to be 16</span></span><br><span class="line">    dim3 <span class="title function_">numBlocks</span><span class="params">(DivUp(iWidth, numThreads.x), DivUp(iHeight, numThreads.y))</span>;</span><br><span class="line"></span><br><span class="line">    cuDeadPixelCorrectionRGGB&lt;&lt;&lt;numBlocks, numThreads, <span class="number">20</span> * <span class="number">20</span> * <span class="keyword">sizeof</span>(<span class="type">unsigned</span> <span class="type">short</span>)&gt;&gt;&gt;(pSrc, pDst, iWidth, iHeight, iSrcStride, iDstStride, iThreshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">cuDeadPixelCorrectionGBRG</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> *pSrc, <span class="type">unsigned</span> <span class="type">short</span> *pDst, <span class="type">int</span> iWidth, <span class="type">int</span> iHeight, <span class="type">int</span> iSrcStride, <span class="type">int</span> iDstStride, <span class="type">unsigned</span> <span class="type">short</span> iThreshold)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> dx = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> dy = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    <span class="keyword">if</span> (dx &gt;= iWidth || dy &gt;= iHeight)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> lx = threadIdx.x;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> ly = threadIdx.y;</span><br><span class="line">    <span class="comment">// twice of half filter length plus local size</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> iBlockLen = <span class="number">4</span> + DEMOSAIC_LOCAL_SIZE;</span><br><span class="line">    <span class="comment">// the offset at the start of the row</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">    <span class="comment">// index to the current pixel</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    cached[iLocalIdx] = pSrc[dy * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy additional data for border</span></span><br><span class="line">    <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cached[iLocalRowStartIdx + lx] = pSrc[dy * iSrcStride + iSrcX];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">        &#123;</span><br><span class="line">            EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cached[iLocalIdx + <span class="number">2</span>] = pSrc[dy * iSrcStride + iSrcX];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ly &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> iSrcY = dy - <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (iSrcY &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cached[ly * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[ly * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[ly * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (ly &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">        &#123;</span><br><span class="line">            EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">// the bottom of local box may not aligned with the bottom of the image</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sync</span></span><br><span class="line">    __syncthreads();</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> pixelNeig[<span class="number">8</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> centerPixel = cached[iLocalIdx];</span><br><span class="line">    <span class="keyword">if</span> (dy % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// this is a B row</span></span><br><span class="line">        <span class="keyword">if</span> (dx % <span class="number">2</span> == <span class="number">1</span>) &#123; <span class="comment">// this is a B pixel, changing the index can support GBRG format</span></span><br><span class="line">            pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">            pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">            pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">            pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">            pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">            pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">            pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">            pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">// this is a G pixel in the B row</span></span><br><span class="line">            pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">            pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">            pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">            pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">            pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">            pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">            pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">            pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="comment">// this is a R row</span></span><br><span class="line">        <span class="keyword">if</span> (dx % <span class="number">2</span> == <span class="number">1</span>) &#123; <span class="comment">// this is a G pixel in the R row, changing the index can support GBRG format</span></span><br><span class="line">            pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">            pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">            pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">            pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">            pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">            pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">            pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">            pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">// this is a R pixel</span></span><br><span class="line">            pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">            pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">            pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">            pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">            pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">            pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen + <span class="number">-2</span>];</span><br><span class="line">            pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">            pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">2</span> * iBlockLen +  <span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> medianV;</span><br><span class="line">    cuClassicMedianFilter(pixelNeig, <span class="number">8</span>, &amp;medianV);</span><br><span class="line">    <span class="type">bool</span> bAllPostive = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">bool</span> bAllNegative = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">bool</span> bAllDiffGT = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> pixelNeigDiff = (<span class="type">int</span>)pixelNeig[i] - (<span class="type">int</span>)centerPixel;</span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &gt; <span class="number">0</span>) bAllNegative = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt; <span class="number">0</span>) bAllPostive = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt; <span class="number">0</span>) pixelNeigDiff = -pixelNeigDiff;</span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt;= iThreshold) bAllDiffGT = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> iDstIdx = dy * iDstStride + dx;</span><br><span class="line">    pDst[iDstIdx] = centerPixel;</span><br><span class="line">    <span class="keyword">if</span>(bAllPostive == <span class="literal">true</span> || bAllNegative == <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(bAllDiffGT == <span class="literal">true</span>) &#123;</span><br><span class="line">            pDst[iDstIdx] = medianV;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">DeadPixelCorrectionGBRG</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span>* pSrc, <span class="type">unsigned</span> <span class="type">short</span>* pDst, <span class="type">int</span> iWidth, <span class="type">int</span> iHeight, <span class="type">int</span> iSrcStride, <span class="type">int</span> iDstStride, <span class="type">unsigned</span> <span class="type">short</span> iThreshold)</span></span><br><span class="line">&#123;</span><br><span class="line">    dim3 <span class="title function_">numThreads</span><span class="params">(<span class="number">16</span>, <span class="number">16</span>, <span class="number">1</span>)</span>; <span class="comment">// do not change, has to be 16</span></span><br><span class="line">    dim3 <span class="title function_">numBlocks</span><span class="params">(DivUp(iWidth, numThreads.x), DivUp(iHeight, numThreads.y))</span>;</span><br><span class="line"></span><br><span class="line">    cuDeadPixelCorrectionGBRG&lt;&lt;&lt;numBlocks, numThreads, <span class="number">20</span> * <span class="number">20</span> * <span class="keyword">sizeof</span>(<span class="type">unsigned</span> <span class="type">short</span>)&gt;&gt;&gt;(pSrc, pDst, iWidth, iHeight, iSrcStride, iDstStride, iThreshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__global__ <span class="type">void</span> <span class="title function_">cuDeadPixelCorrectionMono</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> *pSrc, <span class="type">unsigned</span> <span class="type">short</span> *pDst, <span class="type">int</span> iWidth, <span class="type">int</span> iHeight, <span class="type">int</span> iSrcStride, <span class="type">int</span> iDstStride, <span class="type">unsigned</span> <span class="type">short</span> iThreshold)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> dx = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> dy = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">    <span class="keyword">if</span> (dx &gt;= iWidth || dy &gt;= iHeight)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> lx = threadIdx.x;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> ly = threadIdx.y;</span><br><span class="line">    <span class="comment">// twice of half filter length plus local size</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> iBlockLen = <span class="number">4</span> + DEMOSAIC_LOCAL_SIZE;</span><br><span class="line">    <span class="comment">// the offset at the start of the row</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> iLocalRowStartIdx = (ly + <span class="number">2</span>) * iBlockLen;</span><br><span class="line">    <span class="comment">// index to the current pixel</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> iLocalIdx = iLocalRowStartIdx + lx + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    cached[iLocalIdx] = pSrc[dy * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy additional data for border</span></span><br><span class="line">    <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cached[iLocalRowStartIdx + lx] = pSrc[dy * iSrcStride + iSrcX];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">        &#123;</span><br><span class="line">            EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cached[iLocalIdx + <span class="number">2</span>] = pSrc[dy * iSrcStride + iSrcX];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ly &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> iSrcY = dy - <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (iSrcY &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cached[ly * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[ly * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[ly * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (ly &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">        &#123;</span><br><span class="line">            EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lx &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx - <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lx &gt;= (DEMOSAIC_LOCAL_SIZE - <span class="number">2</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcX = dx + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcX &gt;= iWidth)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcX, <span class="number">0</span>, iWidth - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">4</span>] = pSrc[iSrcY * iSrcStride + iSrcX];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">// the bottom of local box may not aligned with the bottom of the image</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (dy &gt;= iHeight - <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> iSrcY = dy + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (iSrcY &gt;= iHeight)</span><br><span class="line">            &#123;</span><br><span class="line">                EXTRAPOLATE(iSrcY, <span class="number">0</span>, iHeight - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            cached[(ly + <span class="number">4</span>) * iBlockLen + lx + <span class="number">2</span>] = pSrc[iSrcY * iSrcStride + dx];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sync</span></span><br><span class="line">    __syncthreads();</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> pixelNeig[<span class="number">8</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> centerPixel = cached[iLocalIdx];</span><br><span class="line">    pixelNeig[<span class="number">0</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">    pixelNeig[<span class="number">1</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">    pixelNeig[<span class="number">2</span>] = cached[iLocalIdx + <span class="number">-1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">    pixelNeig[<span class="number">3</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">    pixelNeig[<span class="number">4</span>] = cached[iLocalIdx +  <span class="number">0</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line">    pixelNeig[<span class="number">5</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen + <span class="number">-1</span>];</span><br><span class="line">    pixelNeig[<span class="number">6</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen +  <span class="number">0</span>];</span><br><span class="line">    pixelNeig[<span class="number">7</span>] = cached[iLocalIdx +  <span class="number">1</span> * iBlockLen +  <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> medianV;</span><br><span class="line">    cuClassicMedianFilter(pixelNeig, <span class="number">8</span>, &amp;medianV);</span><br><span class="line">    <span class="type">bool</span> bAllPostive = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">bool</span> bAllNegative = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">bool</span> bAllDiffGT = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> pixelNeigDiff = (<span class="type">int</span>)pixelNeig[i] - (<span class="type">int</span>)centerPixel;</span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &gt; <span class="number">0</span>) bAllNegative = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt; <span class="number">0</span>) bAllPostive = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt; <span class="number">0</span>) pixelNeigDiff = -pixelNeigDiff;</span><br><span class="line">        <span class="keyword">if</span>(pixelNeigDiff &lt;= iThreshold) bAllDiffGT = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> iDstIdx = dy * iDstStride + dx;</span><br><span class="line">    pDst[iDstIdx] = centerPixel;</span><br><span class="line">    <span class="keyword">if</span>(bAllPostive == <span class="literal">true</span> || bAllNegative == <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(bAllDiffGT == <span class="literal">true</span>) &#123;</span><br><span class="line">            pDst[iDstIdx] = medianV;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">DeadPixelCorrectionMono</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span>* pSrc, <span class="type">unsigned</span> <span class="type">short</span>* pDst, <span class="type">int</span> iWidth, <span class="type">int</span> iHeight, <span class="type">int</span> iSrcStride, <span class="type">int</span> iDstStride, <span class="type">unsigned</span> <span class="type">short</span> iThreshold)</span></span><br><span class="line">&#123;</span><br><span class="line">    dim3 <span class="title function_">numThreads</span><span class="params">(<span class="number">16</span>, <span class="number">16</span>, <span class="number">1</span>)</span>; <span class="comment">// do not change, has to be 16</span></span><br><span class="line">    dim3 <span class="title function_">numBlocks</span><span class="params">(DivUp(iWidth, numThreads.x), DivUp(iHeight, numThreads.y))</span>;</span><br><span class="line"></span><br><span class="line">    cuDeadPixelCorrectionMono&lt;&lt;&lt;numBlocks, numThreads, <span class="number">20</span> * <span class="number">20</span> * <span class="keyword">sizeof</span>(<span class="type">unsigned</span> <span class="type">short</span>)&gt;&gt;&gt;(pSrc, pDst, iWidth, iHeight, iSrcStride, iDstStride, iThreshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>






      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://example.com/2025/02/27/cameraIsp/ISP-pipeline%E4%B9%8BDPC/" title="ISP pipeline之DPC" target="_blank" rel="external">http://example.com/2025/02/27/cameraIsp/ISP-pipeline之DPC/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/Stephen-Lu-Fahai" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/Stephen-Lu-Fahai" target="_blank"><span class="text-dark">StephenLu</span><small class="ml-1x">Embedded Software Developer</small></a></h3>
        <div>Just4饭</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2025/03/07/cameraIsp/ISP-pipeline%E4%B9%8Bmipi%E4%B8%8Eraw10%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8E%8B%E7%BC%A9%E4%B8%8E%E8%A7%A3%E5%8C%85/" title="ISP pipeline之mipi与raw10数据的压缩与解包"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2025/02/27/cameraIsp/ISP-pipeline%E6%A6%82%E8%BF%B0/" title="ISP pipeline概述"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: '说点什么...',
    avatar: 'mm',
    meta: meta,
    pageSize: '15' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>